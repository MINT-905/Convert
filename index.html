<!DOCTYPE html>
<html>
<head>
  <title>テキストファイルを画像に変換</title>
</head>
<body>
  <input type="file" id="txtFileInput" accept=".txt">
  <button onclick="convertToImages()">変換</button>
  <a id="downloadLink" style="display: none;" download="images.zip">ZIPダウンロード</a>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
  <script>
    function convertToImages() {
      const fileInput = document.getElementById('txtFileInput');
      const file = fileInput.files[0];
      const reader = new FileReader();

      reader.onload = function (e) {
        const content = e.target.result;
        const lines = content.split('\n');

        const zip = new JSZip();
        const imagePromises = lines.map((line, index) => {
          return new Promise(resolve => {
            const textElement = document.createElement('div');
            textElement.textContent = line;
            document.body.appendChild(textElement);

            html2canvas(textElement).then(canvas => {
              const imageDataURL = canvas.toDataURL('image/png');
              zip.file(`image${index}.png`, imageDataURL.substr(imageDataURL.indexOf(',') + 1), { base64: true });

              document.body.removeChild(textElement);
              resolve();
            });
          });
        });

        Promise.all(imagePromises).then(() => {
          zip.generateAsync({ type: 'blob' }).then(function (content) {
            const downloadLink = document.getElementById('downloadLink');
            downloadLink.href = URL.createObjectURL(content);
            downloadLink.style.display = 'block';
          });
        });
      };

      reader.readAsText(file);
    }
  </script>
</body>
</html>
